<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="ko">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>아이딧(IDID) 노래 소트</title>

<script type="text/javascript">
/*********************************************************
 * 1) 정렬할 항목(노래 리스트)
 *********************************************************/
var namMember = new Array(
  "<br>제멋대로 찬란하게</br>",
  "<br>SLOW TIDE</br>",
  "<br>STEP IT UP</br>",
  "<br>ImPerfect</br>",
  "<br>So G.oo.D (네가 미치도록 좋아)</br>",
  "<br>STICKY BOMB</br>",
  "<br>꿈을 꿰뚫는 순간(飛必沖天)</br>",
  "<br>꽃피울 CROWN</br>",
  "<br>PUSH BACK</br>",
  "<br>Heaven Smiles</br>"
);

/*********************************************************
 * 2) 소트 로직 변수들
 *********************************************************/
var lstMember = new Array();
var parent = new Array();
var equal = new Array();
var rec = new Array();

var cmp1, cmp2;
var head1, head2;
var nrec;

var totalSize;
var finishSize;
var finishFlag;

/*********************************************************
 * 3) 초기화
 *********************************************************/
function initList(){
  var n = 0;
  var mid;
  var i;

  // 정렬할 배열
  lstMember[n] = new Array();
  for (i=0; i<namMember.length; i++) {
    lstMember[n][i] = i;
  }
  parent[n] = -1;
  totalSize = 0;
  n++;

  // 분할
  for (i=0; i<lstMember.length; i++) {
    if (lstMember[i].length >= 2) {
      mid = Math.ceil(lstMember[i].length / 2);

      lstMember[n] = lstMember[i].slice(0, mid);
      totalSize += lstMember[n].length;
      parent[n] = i;
      n++;

      lstMember[n] = lstMember[i].slice(mid, lstMember[i].length);
      totalSize += lstMember[n].length;
      parent[n] = i;
      n++;
    }
  }

  // 저장용 배열
  for (i=0; i<namMember.length; i++) rec[i] = 0;
  nrec = 0;

  // 동점(무승부) 저장
  for (i=0; i<=namMember.length; i++) equal[i] = -1;

  cmp1 = lstMember.length - 2;
  cmp2 = lstMember.length - 1;
  head1 = 0;
  head2 = 0;

  finishSize = 0;
  finishFlag = 0;

  updateProgress();
}

/*********************************************************
 * 4) 진행도 표시
 *********************************************************/
function updateProgress(){
  var percent = 0;
  if (totalSize > 0) percent = Math.floor(finishSize * 100 / totalSize);
  var el = document.getElementById("progress");
  if (el) el.innerHTML = "진행도 " + percent + "%";
}

/*********************************************************
 * 5) 햅틱(미세 진동) + 선택 처리 래퍼
 *    - 모바일에서만 체감되고, 지원 안 하면 그냥 무시됨
 *********************************************************/
function choose(flag){
  // finishFlag 체크
  if (finishFlag != 0) return;

  // 미세 진동 (지원 브라우저에서만)
  try {
    if (navigator && navigator.vibrate) {
      navigator.vibrate(18); // 10~25ms 정도가 "미세" 느낌
    }
  } catch (e) {}

  sortList(flag);
}

/*********************************************************
 * 6) 소트 수행
 * flag: -1(왼쪽), 0(동점), 1(오른쪽)
 * 이번 UI는 동점 버튼이 없으므로 -1/1만 들어옴
 *********************************************************/
function sortList(flag){
  var i;

  // rec에 저장
  if (flag < 0) {
    rec[nrec] = lstMember[cmp1][head1];
    head1++;
    nrec++;
    finishSize++;

    while (equal[rec[nrec-1]] != -1) {
      rec[nrec] = lstMember[cmp1][head1];
      head1++;
      nrec++;
      finishSize++;
    }
  }
  else if (flag > 0) {
    rec[nrec] = lstMember[cmp2][head2];
    head2++;
    nrec++;
    finishSize++;

    while (equal[rec[nrec-1]] != -1) {
      rec[nrec] = lstMember[cmp2][head2];
      head2++;
      nrec++;
      finishSize++;
    }
  }
  else {
    // (동점 UI는 없지만 로직 유지)
    rec[nrec] = lstMember[cmp1][head1];
    head1++;
    nrec++;
    finishSize++;

    while (equal[rec[nrec-1]] != -1) {
      rec[nrec] = lstMember[cmp1][head1];
      head1++;
      nrec++;
      finishSize++;
    }

    equal[rec[nrec-1]] = lstMember[cmp2][head2];

    rec[nrec] = lstMember[cmp2][head2];
    head2++;
    nrec++;
    finishSize++;

    while (equal[rec[nrec-1]] != -1) {
      rec[nrec] = lstMember[cmp2][head2];
      head2++;
      nrec++;
      finishSize++;
    }
  }

  // 한쪽 리스트를 다 읽었으면 나머지 복사
  if (head1 < lstMember[cmp1].length && head2 == lstMember[cmp2].length) {
    while (head1 < lstMember[cmp1].length) {
      rec[nrec] = lstMember[cmp1][head1];
      head1++;
      nrec++;
      finishSize++;
    }
  }
  else if (head1 == lstMember[cmp1].length && head2 < lstMember[cmp2].length) {
    while (head2 < lstMember[cmp2].length) {
      rec[nrec] = lstMember[cmp2][head2];
      head2++;
      nrec++;
      finishSize++;
    }
  }

  // 부모 리스트 갱신
  if (head1 == lstMember[cmp1].length && head2 == lstMember[cmp2].length) {
    for (i=0; i<lstMember[cmp1].length + lstMember[cmp2].length; i++) {
      lstMember[parent[cmp1]][i] = rec[i];
    }
    lstMember.pop();
    lstMember.pop();
    cmp1 = cmp1 - 2;
    cmp2 = cmp2 - 2;
    head1 = 0;
    head2 = 0;

    // 새 비교 전에 rec 초기화
    if (head1 == 0 && head2 == 0) {
      for (i=0; i<namMember.length; i++) rec[i] = 0;
      nrec = 0;
    }
  }

  updateProgress();

  // 완료면 결과 표시
  if (cmp1 < 0) {
    var p = document.getElementById("progress");
    if (p) p.innerHTML = "정렬 완료!";
    showResult();
    finishFlag = 1;
  } else {
    showImage();
  }
}

/*********************************************************
 * 7) 결과 표시
 *********************************************************/
function showResult(){
  var ranking = 1;
  var sameRank = 1;
  var str = "";
  var i;

  str += "<table id='resultTable'>";
  str += "<tr><th>순위</th><th>이름</th></tr>";

  for (i=0; i<namMember.length; i++) {
    str += "<tr><td class='rankCell'>" + ranking + "</td><td class='nameCell'>" +
           namMember[lstMember[0][i]] + "</td></tr>";

    if (i < namMember.length - 1) {
      if (equal[lstMember[0][i]] == lstMember[0][i+1]) {
        sameRank++;
      } else {
        ranking += sameRank;
        sameRank = 1;
      }
    }
  }
  str += "</table>";

  document.getElementById("resultField").innerHTML = str;
}

/*********************************************************
 * 8) 비교 화면 표시
 *********************************************************/
function showImage(){
  document.getElementById("leftField").innerHTML =
    namMember[lstMember[cmp1][head1]];
  document.getElementById("rightField").innerHTML =
    namMember[lstMember[cmp2][head2]];
}
</script>

<style type="text/css">
/* 전체 테마 */
body{
  background-color:#030303;
  color:#00e1ff;
  font-family:'굴림', Gulim, sans-serif;
  margin: 0;
  padding: 0;
}

/* 상단 타이틀/진행도 */
#battleNumber{
  text-align:center;
  padding: 14px 0;
}

#title{
  font-size: 22px;
  font-weight: bold;
  margin-bottom: 6px;
}

#progress{
  font-size: 15px;
  opacity: 0.9;
}

/* 메인 선택 테이블 */
#mainTable{
  width: 420px;
  margin-left: auto;
  margin-right: auto;
  border-collapse: separate;
  border-spacing: 14px 10px;
}

/* 선택 박스: Flex로 세로/가로 중앙 정렬 */
#leftField, #rightField{
  width: 200px;
  height: 240px;

  display: flex;
  align-items: center;     /* 세로 중앙 */
  justify-content: center; /* 가로 중앙 */

  border: 1.5px solid #00e1ff;
  background-color: #030303;
  cursor: pointer;

  font-size: 18px;
  line-height: 1.3;
  text-align: center;

  transition: all 0.15s ease-in-out;

  /* 모바일에서 300ms 딜레이/하이라이트 줄이기 */
  -webkit-tap-highlight-color: rgba(0,0,0,0);
  touch-action: manipulation;
}

/* hover */
#leftField:hover, #rightField:hover{
  background-color: #050505;
  box-shadow:
    0 0 8px #00e1ff,
    0 0 16px rgba(0, 225, 255, 0.6);
}

/* click */
#leftField:active, #rightField:active{
  transform: scale(0.95);
  box-shadow: 0 0 6px #00e1ff;
}

/* 결과 테이블 */
#resultTable{
  margin: 0 auto;
  border-collapse: collapse;
  font-size: 15px;
  min-width: 340px;
}

#resultTable th, #resultTable td{
  border: 1.5px solid #00e1ff;
  padding: 8px 10px;
}

.rankCell{
  text-align: right;
  width: 60px;
}

.nameCell{
  text-align: left;
}

/* 모바일에서 살짝 더 키우기 */
@media (max-width: 480px){
  #mainTable{
    width: 380px;
  }

  #title{
    font-size: 24px;
  }

  #progress{
    font-size: 16px;
  }

  #leftField, #rightField{
    width: 180px;
    height: 260px;
    font-size: 19px;
  }

  #resultTable{
    font-size: 16px;
  }
}
</style>
</head>

<body>
<table id="mainTable" align="center">
  <tr>
    <td id="battleNumber" colspan="2">
      <div id="title">당신의 최애 IDID 노래는?</div>
      <div id="progress">진행도 0%</div>
    </td>
  </tr>
  <tr>
    <td id="leftField" onclick="choose(-1);">&nbsp;</td>
    <td id="rightField" onclick="choose(1);">&nbsp;</td>
  </tr>
</table>

<br>

<div id="resultField" style="text-align:center;">
  <!-- 결과가 여기 표시됨 -->
</div>

<script type="text/javascript">
initList();
showImage();
</script>
</body>
</html>
